# Backlog Specification – 2025-10-07

本ドキュメントは 2025-10-07 時点で合意した改善リクエストを Issue として分解し、各タスクの背景と要件を整理したものです。  
`docs/TODO_codex.md` の「新規TODO（2025-10-07）」セクションと対応しており、Issue 作成時には本ドキュメントを参照してください。

---

## 優先対応

### Issue H01 – 保存先設定 UI をヘッダ直下に再配置
- **TODO**: 9.A
- **背景**: 保存先設定は最初に必ず操作する箇所だが、現在はタブ内にあり気付きづらい。
- **要件**
  - `<header>` 直下に保存先設定ブロックを常時表示する。
  - 未設定時: 既存の案内文を表示し、フォルダ選択を促す。
  - 設定済み時: 現在の保存先パスを表示し、横並びで「変更」「リセット」ボタンを配置。注釈「※画像処理後のファイルが自動保存される場所です。」は維持。
  - 既存タブ内の保存先関連 UI は撤去し、新ブロックに集約する。
  - レイアウト・スタイルは現行デザインに合わせる。
- **受け入れ条件**
  - 初回アクセスで保存先未設定の場合、新ブロックが明示的に保存先選択を促す。
  - 保存先設定済みの場合、表示内容と操作が既存機能と等価に動作する。
  - 出力ルート変更／リセット後の挙動が現在と同等に機能する。
- **Status**: ✅ 完了 (2025-10-08)

### Issue H02 – プロファイル表示名と出力ファイル名の分離
- **TODO**: 9.B
- **背景**: `layout_settings.json` の `name` が UI 表示名とファイル名の双方で使用されており、柔軟な変更が難しい。
- **要件**
  - プロファイル定義を表示名（UI 用）と出力ファイルベース名（保存ファイル名）に分割する。
  - 既存データを移行する仕組み（マイグレーションまたは初回読み込み時の補正）を用意する。
  - UI で双方を編集可能にする。
- **受け入れ条件**
  - 既存プロファイルを壊さずに読み込み・保存が行える。
- **備考**: 命名規則はお任せ（英数字ハイフン推奨、表示名は日本語可）。
- **Status**: ✅ 完了 (2025-10-08)

### Issue H03 – プロファイル追加・削除機能の実装
- **TODO**: 9.C
- **背景**: プロファイル数が固定で柔軟性が無いため、UI から追加・削除できるようにしたい。
- **要件**
  - プロファイルリストに「＋」ボタンを追加し、モーダルで以下のフィールドを入力して追加できるようにする。  
    ‣ プロファイル表示名  
    ‣ 出力ファイル名  
    ‣ 幅 / 高さ  
    ‣ 初期出力形式（チェックボックス形式: JPG / PNG / PSD）  
    ‣ 「プロファイルの追加」 / 「キャンセル」ボタン
  - 既存プロファイルの詳細画面に「このプロファイルを削除する」操作を追加し、確認ダイアログで承認を得てから削除する。
  - 永続化は現行どおり `localStorage` ベースで行う。削除後は config から除去する。
- **受け入れ条件**
  - 追加・削除後に再読み込みしても設定が保持される。
  - 最低 1 プロファイルは常に存在する（削除制限を設けるか、削除後にデフォルトを復活させる）。
- **Status**: ✅ 完了 (2025-10-08)

### Issue H04 – 設定タブへのデバッグモード移設とタブ整理
- **TODO**: 9.D
- **背景**: デバッグモード設定が散在しており、設定画面の UX を整理したい。
- **要件**
  - 現行のタブ構成を踏襲しながら、デバッグモード関連 UI を設定タブ内に移動する。
  - レイアウトや切り替え挙動は既存 UI のスタイル／実装を尊重する。
- **受け入れ条件**
  - 設定タブにデバッグ機能がまとまり、他タブからは削除される。
  - デバッグフラグの動作が現行と同等に維持される。
- **Status**: ✅ 完了 (2025-10-08)

### Issue H05 – レイアウトパターン表示文言の見直し
- **TODO**: 9.E
- **背景**: 現在の「現在の設定概要」という文言が分かりづらい。
- **要件**
  - 見出しを「出力設定一覧」に変更する。
  - 形式が未選択の場合は「ファイルは出力されません」という文言を該当スロットに表示する。
- **受け入れ条件**
  - UI 上で文言が置き換わり、未選択時の挙動が明示される。
- **Status**: ✅ 完了 (2025-10-08)

### Issue H06 – PSD 出力のレイヤーマスク対応
- **TODO**: 9.F
- **背景**: 現状は指定サイズに強制クロップしており、PSD で編集余地が残らない。
- **要件**
  - PSD 出力時、各画像レイヤーに矩形マスクを適用し、非表示領域を保持したまま書き出す。
  - 画像枚数に応じたマスク比率（既存のレイアウト計算）を尊重する。
  - レイヤー名は現行どおり元ファイル名を使用する。
- **受け入れ条件**
  - PSD を開いた際にレイヤーマスクが適用され、元画像全体を保持していること。
  - 既存の JPG/PNG 出力には影響しないこと。

### Issue H07 – 商品抽出範囲調整の UX/データフロー改善
- **TODO**: 9.G
- **背景**: 調整 UI がページ下部に表示され、操作性が低い。また保存内容が出力に反映されない不具合がある。
- **要件**
  - ギャラリーでサムネイルをクリックした際、該当サムネイル直下（フォルダグループの直後）に調整パネルを挿入する。表示は同時に 1 件のみ。
  - 保存後に即座に反映されるよう処理フローを修正する（詳細挙動は調整しながら検証）。
  - 調整情報を `localStorage` に保存し、同じファイル名で再処理した際は自動で適用する。
- **受け入れ条件**
  - UI がサムネイル直下に展開される。
  - 保存後のレイアウト出力に調整内容が反映される。
  - 再ドロップ時に調整情報が自動で復元される。

### Issue H08 – デバッグモードに「全設定を削除」機能を追加
- **TODO**: 9.H
- **背景**: 出力ルートなどの設定が破損した場合の復旧手段が分かりづらい。
- **要件**
  - デバッグモード内に「全設定を削除」ボタンを追加し、ローカルで保持している設定・キャッシュ類（プロファイル設定、出力ルート、その他関連ストレージ）をすべてリセットする。
  - 実行前に注意書きと確認ダイアログを表示する。
- **受け入れ条件**
  - 実行後に localStorage 等の設定が初期状態に戻ること。

### Issue H09 – フィードバック学習（未実装）のプレースホルダ追加
- **TODO**: 9.I
- **背景**: YOLO 学習用のフィードバック保存機能を将来的に実装予定。
- **要件**
  - 設定画面に「フィードバック学習（未実装）」ボタンまたはプレースホルダを追加し、現状は未実装である旨を明示する。
- **受け入れ条件**
  - ボタンを押しても処理は走らず、未実装であることが分かる文言を表示する。

### Issue H10 – YOLO 学習モードの TODO 追記
- **TODO**: 9.J
- **背景**: フィードバック保存機能と連携する学習モードを後日検討する必要がある。
- **要件**
  - Web アプリ側に TODO 表示または簡易説明を追加し、現時点で未実装であると周知する。
  - 別ツールとして切り出す可能性がある旨をメモする。
- **受け入れ条件**
  - ユーザーが学習モードが未実装であることを理解できる。

---

## 低優先度

### Issue L01 – CSS スタイル体系の再設計
- **TODO**: 9.L1
- **要件概要**: UI ライブラリ導入検討、クラス・属性設計の見直し。具体案は別途検討する。

### Issue L02 – GitHub 運用改善
- **TODO**: 9.L2
- **要件概要**: ラベル／ワークフロー整備、gpt-5-codex への直接依存削減。段階的導入を想定。

### Issue L03 – GitHub Pages ワークフロー削除
- **TODO**: 9.L3
- **要件概要**: 旧 GitHub Pages 用 Action を調査し、不要になった YAML などを削除する。
- **Status**: ✅ 完了 (2025-10-08)

### Issue L04 – 代替デプロイ先の検討
- **TODO**: 9.L4
- **要件概要**: Vercel 以外のデプロイ先（例: Cloudflare Pages 等）を比較検討する。

### Issue L05 – 解析ツールの追加
- **TODO**: 9.L5
- **要件概要**: Vercel Analytics / GTM / Microsoft Clarity の導入。導入順と設置ページは別途検討。

### Issue L06 – ドメイン移行
- **TODO**: 9.L6
- **要件概要**: `asterisknautz.net` のサブドメインへの移行準備（DNS 設定、SSL 等）。

### Issue L07 – 背景透過機能の検討
- **TODO**: 9.L7
- **要件概要**: 切り抜き API の利用含めて要否を判断。Photoshop との差分を踏まえて検討する。

---

## 運用メモ
- Issue 作成時は「背景」「目的」「要件」「受け入れ条件」「関連 TODO（本ドキュメント参照）」をテンプレ化して記録する。
- 実装を開始する前に、仕様が十分か簡易レビューを行う。
- 実装完了後は該当 TODO チェックボックスを更新し、本ドキュメントにも結果を追記する。
